(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{338:function(e,t,a){e.exports=a(643)},343:function(e,t,a){},344:function(e,t,a){},643:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(8),i=a.n(o),c=(a(343),a(344),a(15)),l=a(26),u=a(289),s=a(278),m=a(295),d=a(279),f=a(28),p=a(133),E=a(292),v=a(67),g=a(84),b=a(49),y=a(108),h=a(134),O=a(287),I=a(290),w=a(41),T=a(39),S={noRequested:function(){return{state:"NO_REQUESTED"}},fetching:function(){return{state:"FETCHING"}},loaded:function(e){return{state:"LOADED",data:e}},error:function(e){return{state:"ERROR",error:e}},or:function(e,t){return"LOADED"===e.state?e.data:t},map:function(e,t){return C.of(e).map(t).unwrap()}},C=function(){function e(t){Object(w.a)(this,e),this.nr=t}return Object(T.a)(e,null,[{key:"of",value:function(t){return new e(t)}}]),Object(T.a)(e,[{key:"orElse",value:function(e){return"LOADED"===this.nr.state&&this.nr.data||e}},{key:"map",value:function(t){var a;switch(this.nr.state){case"ERROR":a=S.error(this.nr.error);break;case"FETCHING":a=S.fetching();break;case"LOADED":var n=t(this.nr.data);a=S.loaded(n);break;case"NO_REQUESTED":default:a=S.noRequested()}return new e(a)}},{key:"unwrap",value:function(){return this.nr}}]),e}(),D=a(644),j=a(645),N=a(296);function k(e){return r.a.createElement(g.a,{gutter:[8,8]},r.a.createElement(b.a,{span:24},r.a.createElement(N.a,{message:"Tip",description:r.a.createElement("div",{onClick:e.onNewInvoice},"Puedes presionar aqu\xed para agregar",r.a.createElement("br",null),"income"===e.type?"un nuevo ingreso":"una nueva factura"," o presiona ",r.a.createElement("b",null," Control+i")),type:"info",showIcon:!0,icon:r.a.createElement(D.a,null)})),r.a.createElement(b.a,{span:24},r.a.createElement(N.a,{message:"Atenci\xf3n",description:"Este sistema no guarda ning\xfana informacion, asegurate de exportar tus datos!",type:"warning",showIcon:!0,icon:r.a.createElement(j.a,{twoToneColor:"#ebd027"})})),r.a.createElement(b.a,{span:24},r.a.createElement(N.a,{message:r.a.createElement("div",null,"Las facturas se autocompletan con informaci\xf3n de ",r.a.createElement("a",{href:"https://ruc.volpe.com.py"},"ruc.volpe.com.py")),type:"info"})))}var x=a(57),A=a(291),M=a(42),F=a(93),R=a(293),Y=a(81);function L(e,t,a){if(!e&&0!==e)return"";if("string"===typeof e&&e.startsWith("Gs"))return e;var n=a?e:Math.round(e),r=new Intl.NumberFormat("it",{minimumFractionDigits:a||0,maximumFractionDigits:a||0}).format(n),o=void 0!==t?"".concat(t," "):"";return"".concat(o).concat(r)}function B(e){return e?"number"===typeof e?e:"string"!==typeof e?0:Number(e.trim().replace(/\s/g,"").replace(/\./g,"").replace(/,/g,".")):0}var P=a(88),V=a.n(P),U={salary:"LIQUIDACI\xd3N DE SALARIO",summary:"EXTRACTO DE CUENTA (Cuando no exista la obligaci\xf3n legal de expedir comprobante de venta)",other:"OTROS DOCUMENTOS QUE RESPALDAN LOS INGRESOS (Cuando no exista la obligaci\xf3n legal de expedir comprobante de venta)"},G={invoice:"FACTURA",voucher:"BOLETA DE VENTA",simpleVoucher:"BOLETA RESIMPLE",selfInvoice:"AUTOFACTURA",publicEventTicket:"ENTRADA A ESPECT\xc1CULOS P\xdaBLICOS",publicTransportTicket:"BOLETO DE TRANSPORTE P\xdaBLICO",publicIncomeTicket:"COMPROBANTE DE INGRESO O RECIBO DE ENTIDAD P\xdaBLICA, RELIGIOSAS O DE BENEFICIO P\xdaBLICO",airTicket:"TICKET DE TRANSPORTE A\xc9REO",cashierMachineTicket:"TICKET DE M\xc1QUINA REGISTRADORA",debitNote:"NOTA DE D\xc9BITO RECIBIDA",salary:"LIQUIDACI\xd3N DE SALARIO",ips:"EXTRACTO DE CUENTA IPS",cardSummary:"EXTRACTO DE TARJETA DE CR\xc9DITO/TARJETA DE D\xc9BITO",transfer:"TRANSFERENCIAS O GIROS BANCARIOS/ BOLETA DE DEP\xd3SITO",externalTicket:"COMPROBANTE DEL EXTERIOR LEGALIZADO",importTicket:"DESPACHO DE IMPORTACI\xd3N",other:"OTROS COMPROBANTES DE VENTA QUE RESPALDEN EGRESOS (Cuando no exista obligaci\xf3n legal de expedir comprobantes de ventas)"},q={cash:"CONTADO",credit:"CR\xc9DITO",na:"NO APLICA"};function J(e){var t=e.expense,a=e.owner,o=e.onNewRuc,i=e.onSubmit,l=e.onCancel,u=e.editType,s=C.of(a).orElse({doc:"",name:"",div:""}),m=Object(n.useState)(""),d=Object(c.a)(m,2),p=d[0],E=d[1],v=A.a.useForm(),h=Object(c.a)(v,1)[0],O=Object(n.useRef)(null),I=Object(n.useRef)(null);Object(n.useEffect)((function(){t&&(h.setFieldsValue(t),I.current&&I.current.setValue(t.owner.doc))}),[h,t]);var w=C.of(a).map((function(e){return e.letterhead})).orElse("");return Object(n.useEffect)((function(){h.setFields([{name:"letterhead",value:w}])}),[w,h]),r.a.createElement(Y.GlobalHotKeys,{keyMap:{SAVE_EXPENSE:["Control+g"]},handlers:{SAVE_EXPENSE:h.submit}},r.a.createElement(g.a,{gutter:16,style:{padding:8}},r.a.createElement(b.a,{span:24},r.a.createElement("h1",null,"EDIT"===u?"Editando":"Creando")),r.a.createElement(b.a,{span:24},r.a.createElement(A.a,{layout:"vertical",form:h,onFinish:function(e){i(Object(x.a)({},t,{amount:Number(e.amount),date:e.date,letterhead:e.letterhead,expenseNumber:e.expenseNumber,owner:s,type:e.type,isCredit:e.isCredit})),O.current&&O.current.focus(),I.current&&I.current.setValue(""),E("")},wrapperCol:{span:24}},r.a.createElement(A.a.Item,{label:"Fecha",name:"date",rules:[{required:!0}]},r.a.createElement(V.a,{mask:"11/11/11",ref:O,autoFocus:!0,placeholder:"DD/MM/YY (si es salario, poner cualquier d\xeda del mes)",defaultValue:null===t||void 0===t?void 0:t.date})),r.a.createElement(A.a.Item,{label:"Tipo egreso",name:"type"},r.a.createElement(M.a,{options:_(),placeholder:"Tipo de egreso",showSearch:!0})),r.a.createElement(A.a.Item,{label:"Buscar por RUC"},r.a.createElement(y.a,{placeholder:"4787587, Arturo Volpe, ASISMED",onKeyDown:function(e){"Enter"===e.key&&o(p.trim())},ref:I,defaultValue:null===t||void 0===t?void 0:t.owner.doc,onBlur:function(e){E(e.target.value),o(e.target.value)},onChange:function(e){return E(e.target.value)}}),r.a.createElement(g.a,null,r.a.createElement(b.a,null,"Nombre: ",s.name),r.a.createElement(b.a,null,"RUC: ",s.doc,"-",s.div))),r.a.createElement(A.a.Item,{shouldUpdate:function(e,t){return e.type!==t.type}},(function(e){var a=e.getFieldValue("type")||[];return"5"===a[0]&&"gasto"===a[1]&&"DESCJBPN"===a[2]?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(A.a.Item,{name:"letterhead",label:"Timbrado",rules:[{required:!0}]},r.a.createElement(V.a,{mask:"11111111",defaultValue:null===t||void 0===t?void 0:t.letterhead,placeholder:"12345678"})),r.a.createElement(A.a.Item,{label:"Nro Factura",name:"expenseNumber",rules:[{required:!0}]},r.a.createElement(V.a,{mask:"111-111-1111111",defaultValue:null===t||void 0===t?void 0:t.expenseNumber,placeholder:"001-002-1234567"})),r.a.createElement(A.a.Item,{label:"Cr\xe9dito",name:"isCredit"},r.a.createElement(F.a.Group,{defaultValue:null===t||void 0===t?void 0:t.isCredit},r.a.createElement(F.a.Button,{value:!0},"CR\xc9DITO"),r.a.createElement(F.a.Button,{value:!1},"CONTADO"))))})),r.a.createElement(A.a.Item,{label:"Monto",name:"amount",rules:[{required:!0}]},r.a.createElement(R.a,{defaultValue:null===t||void 0===t?void 0:t.amount,style:{width:"100%"},formatter:L,parser:B})),r.a.createElement("pre",{hidden:!0},JSON.stringify(null===t||void 0===t?void 0:t.type,null,2)),r.a.createElement(A.a.Item,null,r.a.createElement(f.a,{type:"primary",htmlType:"submit",style:{width:"50%"}},"Guardar (Control+g)"),r.a.createElement(f.a,{type:"default",onClick:l,style:{width:"50%"}},"Cancelar"))))))}function _(){var e=G;return Object.keys(e).map((function(t){return{value:t,label:e[t]}}))}var z=a(99),K=a.n(z);function W(e){var t=e.replace(" +","+");return fetch("https://sapi.volpe.com.py/find?query=".concat(t)).then((function(e){return e.json()}))}var Q=a(17),X=a.n(Q),H=function(){function e(){Object(w.a)(this,e)}return Object(T.a)(e,[{key:"getDigitoVerificadorBase11",value:function(e){return this.getDigitoVerificador(e,11)}},{key:"getDigitoVerificador",value:function(t,a){for(var n=2,r=0,o="0".charCodeAt(0),i=e.invertirCadena(e.eliminarNoDigitos(t)),c=0;c<i.length;c++){r+=(i.charCodeAt(c)-o)*n++,n>a&&(n=2)}var l=r%a;return l>1?a-l:0}}],[{key:"invertirCadena",value:function(e){return e.split("").reverse().join("")}},{key:"eliminarNoDigitos",value:function(e){for(var t="",a=0;a<e.length;a++)isNaN(parseInt(e[a],10))?t+=e.charCodeAt(a):t+=e[a];return t}}]),e}(),Z=a(72),$=function(){function e(t,a,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];Object(w.a)(this,e),this.period=t,this.owner=a,this.type=n,this.invoices=r,this.incomes=o,this.lastInvoiceId=void 0,this.lastIncomeId=void 0,this.lastInvoiceId=r.reduce((function(e,t){return e<t.id?t.id:e}),0),this.lastIncomeId=o.reduce((function(e,t){return e<t.id?t.id:e}),0)}return Object(T.a)(e,[{key:"mapToForm",value:function(t){return{amount:t.amount,owner:{doc:t.identifier,name:t.name,div:(new H).getDigitoVerificadorBase11(t.identifier)+"",old:"",letterhead:t.letterhead},type:t.type,expenseNumber:t.voucher,letterhead:t.letterhead,date:e.storageToFormDate(t.date),isCredit:"credit"===t.paymentType}}},{key:"mapIngresoToForm",value:function(e){return{amount:e.amount,owner:{doc:e.identifier,name:e.name,div:"",old:"",letterhead:""},type:e.type,incomeNumber:e.voucher,letterhead:e.letterhead,date:e.date,isCredit:"credit"===e.paymentType}}},{key:"mapInvoice",value:function(t,a){return{date:e.dateToStorageFormat(t.date),id:a||++this.lastInvoiceId,paymentType:t.isCredit?"credit":"cash",voucher:t.expenseNumber,letterhead:t.letterhead,type:t.type,identifier:t.owner.doc,amount:t.amount,name:t.owner.name,irpAmount:0,identifierType:"ruc",version:2}}},{key:"mapIncome",value:function(t,a){return{id:a||++this.lastIncomeId,letterhead:t.letterhead,paymentType:t.isCredit?"credit":"cash",date:e.dateToStorageFormat(t.date),voucher:t.incomeNumber,type:t.type,name:t.owner.name,identifier:t.owner.doc,amount:t.amount,irpAmount:0,identifierType:"ruc",version:2}}},{key:"findRuc",value:function(e){var t,a,n;return K.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if((t=Object(Z.findLast)(this.invoices,(function(t){return e===t.identifier})))||(t=Object(Z.findLast)(this.incomes,(function(t){return e===t.identifier})))&&(t.letterhead=""),!t){r.next=4;break}return r.abrupt("return",{doc:t.identifier,old:"",div:(new H).getDigitoVerificadorBase11(t.identifier)+"",letterhead:t.letterhead,name:t.name});case 4:return r.next=6,K.a.awrap(W(e));case 6:if((a=r.sent)&&a.length){r.next=9;break}return r.abrupt("return",{letterhead:"",name:"",div:"",old:"",doc:""});case 9:if(isNaN(Number(e))){r.next=13;break}if(!(n=a.find((function(t){return t.doc===e})))){r.next=13;break}return r.abrupt("return",Object(x.a)({},n,{letterhead:""}));case 13:return r.abrupt("return",Object(x.a)({},a[0],{letterhead:""}));case 14:case"end":return r.stop()}}),null,this)}}],[{key:"mapDateToSetFormat",value:function(e){return X()(e,"DD/MM/YY").format("YYYY-MM-DD")}},{key:"dateToStorageFormat",value:function(e){if(10===e.length){if(e===X()(e,"YYYY/MM/DD").format("YYYY/MM/DD"))return e;throw new Error("Invalid short date: "+e)}return X()(e,"DD/MM/YY").format("YYYY/MM/DD")}},{key:"mapDateFromSetFormat",value:function(e){return X()(e,"YYYY-MM-DD").format("DD/MM/YY")}},{key:"mapSETFormatToMoment",value:function(e){return X()(e,"YYYY-MM-DD")}},{key:"mapMomentToSETFormat",value:function(e){return e.format("YYYY-MM-DD")}},{key:"mapSETFormatToSetMonth",value:function(e){return X()(e,"YYYY-MM-DD").month()+1}},{key:"mapMonthToLocalFormat",value:function(t,a){return e.mapMomentToSETFormat(X()("1990-01-01").month(parseInt(t)-1).year(parseInt(a)))}},{key:"mapLocalToMoment",value:function(e){return X()(e,"YYYY/MM/DD")}},{key:"storageToFormDate",value:function(t){return e.mapLocalToMoment(t).format("DD/MM/YY")}}]),e}();function ee(e,t){var a=Object(n.useState)(e),r=Object(c.a)(a,2),o=r[0],i=r[1];return Object(n.useEffect)((function(){var a=setTimeout((function(){i(e)}),t);return function(){clearTimeout(a)}}),[e,t]),o}var te=["type"],ae=function(){function e(){Object(w.a)(this,e)}return Object(T.a)(e,[{key:"filter",value:function(e,t,a,n){var r=t||"",o=this.getTypeToSearch(r),i=this.cleanSearch(r);return console.log({fullText:i,typeToSearch:o}),e.filter((function(e){var t=!0;if(i&&(t=e.name.toLowerCase().includes(i)||e.identifier.toLowerCase().includes(i)||(e.voucher||"").toLowerCase().includes(i)),o){var r=G[e.type]||U[e.type];t=t&&r.toLowerCase().includes(o)}return t&&(t=$.mapLocalToMoment(e.date).isBetween(a,n,void 0,"[]")),t}))}},{key:"getTypeToSearch",value:function(e){var t=e.toLowerCase().trim()+" ";if(t.includes("type:")){var a=t.indexOf("type:")+"type:".length;return t.substring(a,t.indexOf(" ",a))}}},{key:"cleanSearch",value:function(e){var t=e.toLowerCase().trim()+" ",a=!0,n=!1,r=void 0;try{for(var o,i=te[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var c=o.value,l="".concat(c,":");if(t.includes(l)){var u=t.indexOf(l);console.log("before removing '".concat(l,"': '").concat(t,"'")),t=t.substring(0,u).trim()+t.substring(t.indexOf(" ",u)),console.log("cleaned: "+t)}}}catch(s){n=!0,r=s}finally{try{a||null==i.return||i.return()}finally{if(n)throw r}}return t.trim()}},{key:"filterIncomes",value:function(e,t,a,n){return this.filter(e,t,a,n)}},{key:"filterExpenses",value:function(e,t,a,n){return this.filter(e,t,a,n)}}]),e}(),ne={old:"",div:"",name:"",doc:""},re={date:"",letterhead:"",expenseNumber:"",type:"invoice",owner:ne,amount:0,isCredit:!1};function oe(e){var t,a=Object(n.useState)(),o=Object(c.a)(a,2),i=o[0],l=o[1],u=Object(n.useState)(),m=Object(c.a)(u,2),d=m[0],f=m[1],p=Object(n.useMemo)((function(){return new $(e.period,e.owner,e.type,e.data)}),[e.data,e.period,e.type,e.owner]),E=Object(n.useState)(""),O=Object(c.a)(E,2),I=O[0],w=O[1],T=ee(I,500),S=Object(n.useState)([X()().year(e.period).startOf("year").startOf("day"),X()().year(e.period).endOf("year").endOf("day")]),C=Object(c.a)(S,2),D=C[0],j=C[1],N=Object(n.useState)(e.data),x=Object(c.a)(N,2),A=x[0],M=x[1];function F(){l(JSON.parse(JSON.stringify(re))),f(void 0)}Object(n.useEffect)((function(){M((new ae).filterExpenses(e.data,T,D[0],D[1]))}),[T,e.data,D]);return r.a.createElement(Y.GlobalHotKeys,{keyMap:{ADD_INVOICE:["Control+i"]},handlers:{ADD_INVOICE:F}},r.a.createElement(g.a,{gutter:[8,8],style:{padding:8}},r.a.createElement(b.a,{span:18},r.a.createElement(g.a,{gutter:[8,8],align:"middle"},r.a.createElement(b.a,{span:2,style:{textAlign:"right",fontWeight:"bold"},offset:1},"B\xfasqueda:"),r.a.createElement(b.a,{span:9},r.a.createElement(y.a,{placeholder:"Por ruc/nombre/nro factura",value:I,onChange:function(e){return w(e.target.value)}})),r.a.createElement(b.a,{span:2,style:{textAlign:"right",fontWeight:"bold"}},"Rango:"),r.a.createElement(b.a,{span:9},r.a.createElement(h.a.RangePicker,{value:D,style:{width:"100%"},allowClear:!1,ranges:(t={},Object(v.a)(t,(new Date).getFullYear()-2,[X()().subtract(2,"year").startOf("year"),X()().subtract(2,"year").endOf("year")]),Object(v.a)(t,(new Date).getFullYear()-1,[X()().subtract(1,"year").startOf("year"),X()().subtract(1,"year").endOf("year")]),Object(v.a)(t,(new Date).getFullYear(),[X()().startOf("year"),X()().endOf("year")]),t),onChange:function(e){e&&j([e[0].startOf("day"),e[1].endOf("day")])}}))),r.a.createElement(g.a,null,r.a.createElement(ce,{invoices:A,onRemove:function(t){return e.doRemove(t.id)},onEdit:function(e){f(e.id),l(p.mapToForm(e))}}))),r.a.createElement(b.a,{span:6,style:{border:"1px solid rgb(235, 237, 240)"}},i?r.a.createElement(ie,{current:i,service:p,onCancel:function(){return l(void 0)},editType:d?"EDIT":"NEW",onSave:function(t){e.onSave(t,d).wasNew?(s.a.info("Factura ".concat(t.expenseNumber," guardada"),5),F()):(s.a.info("Registro actualizado",5),f(void 0),l(void 0))}}):r.a.createElement(k,{onNewInvoice:F,type:"invoice"}))))}function ie(e){var t=Object(n.useState)(S.loaded(e.current.owner)),a=Object(c.a)(t,2),o=a[0],i=a[1],l=e.current,u=Object(n.useCallback)((function(t){t!==C.of(o).map((function(e){return null===e||void 0===e?void 0:e.doc})).orElse("")&&e.service.findRuc(t).then((function(e){return i(S.loaded(e))})).catch((function(e){return S.error(e)}))}),[o,e.service]);return Object(n.useEffect)((function(){l.owner&&i(S.loaded(l.owner))}),[l]),r.a.createElement(J,{owner:o,editType:e.editType,onSubmit:function(t){i(S.loaded(ne)),e.onSave(t)},onCancel:e.onCancel,expense:e.current,onNewRuc:u})}function ce(e){return r.a.createElement(O.a,{dataSource:e.invoices,size:"small",pagination:{pageSize:10,showTotal:function(e,t){return"Mostrando ".concat(t[0]," a ").concat(t[1]," de ").concat(e," registros.")}},rowKey:"id",style:{width:"100%"},columns:[{title:"ID",dataIndex:"id",defaultSortOrder:"descend",sorter:function(e,t){return e.id-t.id}},{title:"Tipo",dataIndex:"type",align:"right",render:function(e,t){return r.a.createElement(r.a.Fragment,null,G[t.type],t.paymentType&&r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null)," ",r.a.createElement("small",null,q[t.paymentType])))},sorter:function(e,t){return"".concat(G[e.type]).localeCompare("".concat(G[t.type]))}},{title:"Fecha",dataIndex:"date",sorter:function(e,t){return e.date.localeCompare(t.date)}},{title:"Emisor",dataIndex:"identifier",align:"left",sorter:function(e,t){return e.name.localeCompare(t.name)},render:function(e,t){return r.a.createElement(r.a.Fragment,null,t.name," (",t.identifier,")")}},{title:"Factura",dataIndex:"voucher",align:"right",render:function(e,t){return r.a.createElement(r.a.Fragment,null,t.voucher,r.a.createElement("br",null),r.a.createElement("small",null,t.letterhead))}},{title:"Monto",align:"right",dataIndex:"amount",render:function(e){return L(e)},sorter:function(e,t){return e.amount-t.amount}},{title:"Acciones",dataIndex:"",render:function(t,a){return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{onClick:function(){return e.onEdit(a)}},"Editar"),r.a.createElement(f.a,{type:"danger",onClick:function(){return e.onRemove(a)}},"Eliminar"))}}],summary:function(){var t=Object(Z.sumBy)(e.invoices,"amount");return r.a.createElement("tr",null,r.a.createElement("th",{colSpan:3},"Total (todas las filas)"),r.a.createElement("td",{colSpan:2}),r.a.createElement("td",{className:"ant-table-cell",style:{textAlign:"right",padding:8}},r.a.createElement(I.a.Text,null,L(t))),r.a.createElement("td",null))}})}function le(e){var t=e.income,a=e.owner,o=e.onNewRuc,i=e.onSubmit,l=e.onCancel,u=e.editType,s=C.of(a).orElse({doc:"",name:"",div:""}),m=Object(n.useState)(""),d=Object(c.a)(m,2),p=d[0],E=d[1],v=A.a.useForm(),h=Object(c.a)(v,1)[0],O=Object(n.useRef)(null),I=Object(n.useRef)(null);Object(n.useEffect)((function(){t&&(h.setFieldsValue(t),I.current&&I.current.setValue(t.owner.doc))}),[h,t]);var w=C.of(a).map((function(e){return e.letterhead})).orElse("");return Object(n.useEffect)((function(){h.setFields([{name:"letterhead",value:w}])}),[w,h]),r.a.createElement(Y.GlobalHotKeys,{keyMap:{SAVE_Income:["Control+g"]},handlers:{SAVE_Income:h.submit}},r.a.createElement(g.a,{gutter:16,style:{padding:8}},r.a.createElement(b.a,{span:24},r.a.createElement("h1",null,"EDIT"===u?"Editando":"Nuevo ingreso")),r.a.createElement(b.a,{span:24},r.a.createElement(A.a,{layout:"vertical",form:h,onFinish:function(e){i(Object(x.a)({},t,{amount:Number(e.amount),date:e.date,letterhead:e.letterhead,incomeNumber:e.incomeNumber,owner:s,type:e.type,isCredit:e.isCredit})),O.current&&O.current.focus(),I.current&&I.current.setValue(""),E("")},wrapperCol:{span:24}},r.a.createElement(A.a.Item,{label:"Fecha",name:"date",rules:[{required:!0}]},r.a.createElement(V.a,{mask:"11/11/11",ref:O,autoFocus:!0,placeholder:"DD/MM/YY (si es salario, poner cualquier d\xeda del mes)",defaultValue:null===t||void 0===t?void 0:t.date})),r.a.createElement(A.a.Item,{label:"Tipo ingreso",name:"type"},r.a.createElement(M.a,{options:ue(),placeholder:"Tipo de egreso",showSearch:!0})),r.a.createElement(A.a.Item,{label:"Buscar por RUC"},r.a.createElement(y.a,{placeholder:"4787587, Arturo Volpe, ASISMED",onKeyDown:function(e){"Enter"===e.key&&o(p.trim())},ref:I,defaultValue:null===t||void 0===t?void 0:t.owner.doc,onBlur:function(e){E(e.target.value),o(e.target.value)},onChange:function(e){return E(e.target.value)}}),r.a.createElement(g.a,null,r.a.createElement(b.a,null,"Nombre: ",s.name),r.a.createElement(b.a,null,"RUC: ",s.doc,"-",s.div))),r.a.createElement(A.a.Item,{shouldUpdate:function(e,t){return e.type!==t.type}},(function(e){return"5"===(e.getFieldValue("type")||[])[0]?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(A.a.Item,{name:"letterhead",label:"Timbrado",rules:[{required:!0}]},r.a.createElement(V.a,{mask:"11111111",defaultValue:null===t||void 0===t?void 0:t.letterhead,placeholder:"12345678"})),r.a.createElement(A.a.Item,{label:"Nro Factura",name:"incomeNumber",rules:[{required:!0}]},r.a.createElement(V.a,{mask:"111-111-1111111",defaultValue:null===t||void 0===t?void 0:t.incomeNumber,placeholder:"001-002-1234567"})),r.a.createElement(A.a.Item,{label:"Cr\xe9dito",name:"isCredit"},r.a.createElement(F.a.Group,{defaultValue:!1},r.a.createElement(F.a.Button,{value:!0},"CR\xc9DITO"),r.a.createElement(F.a.Button,{value:!1},"CONTADO"))))})),r.a.createElement(A.a.Item,{label:"Monto",name:"amount",rules:[{required:!0}]},r.a.createElement(R.a,{defaultValue:null===t||void 0===t?void 0:t.amount,style:{width:"100%"},formatter:L,parser:B})),r.a.createElement("pre",{hidden:!0},JSON.stringify(null===t||void 0===t?void 0:t.type,null,2)),r.a.createElement(A.a.Item,null,r.a.createElement(f.a,{type:"primary",htmlType:"submit",style:{width:"50%"}},"Guardar (Control+g)"),r.a.createElement(f.a,{type:"default",onClick:l,style:{width:"50%"}},"Cancelar"))))))}function ue(){var e=U;return Object.keys(e).map((function(t){return{value:t,label:e[t]}}))}var se={date:"",letterhead:"",incomeNumber:"",type:"salary",owner:ne,amount:0,isCredit:!1};function me(e){var t,a=Object(n.useState)(),o=Object(c.a)(a,2),i=o[0],l=o[1],u=Object(n.useState)(),m=Object(c.a)(u,2),d=m[0],f=m[1],p=Object(n.useState)(""),E=Object(c.a)(p,2),O=E[0],I=E[1],w=ee(O,500),T=Object(n.useState)([X()().year(e.period).startOf("year").startOf("day"),X()().year(e.period).endOf("year").endOf("day")]),S=Object(c.a)(T,2),C=S[0],D=S[1],j=Object(n.useState)(e.data),N=Object(c.a)(j,2),A=N[0],M=N[1],F=Object(n.useMemo)((function(){return new $(e.period,e.owner,e.type,[],e.data)}),[e.data,e.period,e.type,e.owner]);function R(e){console.log("new ",e||se),l(JSON.parse(JSON.stringify(e||se))),f(void 0)}return Object(n.useEffect)((function(){M((new ae).filterIncomes(e.data,w,C[0],C[1]))}),[w,e.data,C]),r.a.createElement(g.a,{gutter:[8,8],style:{padding:8}},r.a.createElement(b.a,{span:18},r.a.createElement(g.a,{gutter:[8,8],align:"middle"},r.a.createElement(b.a,{span:2,style:{textAlign:"right",fontWeight:"bold"},offset:1},"B\xfasqueda:"),r.a.createElement(b.a,{span:9},r.a.createElement(y.a,{placeholder:"Por ruc/nombre/nro factura",value:O,onChange:function(e){return I(e.target.value)}})),r.a.createElement(b.a,{span:2,style:{textAlign:"right",fontWeight:"bold"}},"Rango:"),r.a.createElement(b.a,{span:9},r.a.createElement(h.a.RangePicker,{value:C,style:{width:"100%"},allowClear:!1,ranges:(t={},Object(v.a)(t,(new Date).getFullYear()-2,[X()().subtract(2,"year").startOf("year"),X()().subtract(2,"year").endOf("year")]),Object(v.a)(t,(new Date).getFullYear()-1,[X()().subtract(1,"year").startOf("year"),X()().subtract(1,"year").endOf("year")]),Object(v.a)(t,(new Date).getFullYear(),[X()().startOf("year"),X()().endOf("year")]),t),onChange:function(e){e&&D([e[0].startOf("day"),e[1].endOf("day")])}}))),r.a.createElement(g.a,null,r.a.createElement(de,{incomes:A,onRemove:function(t){return e.doRemove(t.id)},onEdit:function(e){f(e.id),l(F.mapIngresoToForm(e))}}))),r.a.createElement(b.a,{span:6,style:{border:"1px solid rgb(235, 237, 240)"}},i?r.a.createElement(fe,{current:i,service:F,onCancel:function(){return l(void 0)},editType:d?"EDIT":"NEW",onSave:function(t){e.onSave(t,d).wasNew?(s.a.info("Factura ".concat(t.incomeNumber," guardada"),5),R(Object(x.a)({},t,{date:""}))):(s.a.info("Income actualizado",5),f(void 0),l(void 0))}}):r.a.createElement(k,{onNewInvoice:function(){return R()},type:"income"})))}function de(e){return r.a.createElement(O.a,{dataSource:e.incomes,size:"small",pagination:{pageSize:10},rowKey:"id",style:{width:"100%"},columns:[{title:"ID",dataIndex:"id",defaultSortOrder:"descend",sorter:function(e,t){return e.id-t.id}},{title:"Detalles",dataIndex:"type",align:"right",render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,U[t.type]),r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null)," ",r.a.createElement("small",null,q[t.paymentType])))},sorter:function(e,t){return U[e.type].localeCompare(U[t.type])}},{title:"Fecha",dataIndex:"date",sorter:function(e,t){return(e.date||"").localeCompare(t.date||"")}},{title:"Receptor",dataIndex:"identifier",align:"left",render:function(e,t){return r.a.createElement(r.a.Fragment,null,t.name,r.a.createElement("br",null),"(",t.identifier,")")}},{title:"Monto",align:"right",dataIndex:"amount",render:function(e){return L(e)},sorter:function(e,t){return e.amount-t.amount}},{title:"Acciones",dataIndex:"",render:function(t,a){return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{onClick:function(){return e.onEdit(a)}},"Editar"),r.a.createElement(f.a,{type:"danger",onClick:function(){return e.onRemove(a)}},"Eliminar"))}}],summary:function(t){var a=Object(Z.sumBy)(e.incomes,"amount");return r.a.createElement("tr",null,r.a.createElement("th",{colSpan:3},"Total (todas las filas)"),r.a.createElement("td",null),r.a.createElement("td",{className:"ant-table-cell",style:{textAlign:"right",padding:8}},r.a.createElement(I.a.Text,null,L(a))),r.a.createElement("td",null))}})}function fe(e){var t=Object(n.useState)(S.loaded(e.current.owner)),a=Object(c.a)(t,2),o=a[0],i=a[1],l=e.current,u=Object(n.useCallback)((function(t){t!==C.of(o).map((function(e){return null===e||void 0===e?void 0:e.doc})).orElse("")&&e.service.findRuc(t).then((function(e){return i(S.loaded(e))})).catch((function(e){return S.error(e)}))}),[o,e.service]);return Object(n.useEffect)((function(){l.owner&&i(S.loaded(l.owner))}),[l]),r.a.createElement(le,{owner:o,editType:e.editType,onSubmit:function(t){i(S.loaded(ne)),e.onSave(t)},onCancel:e.onCancel,income:e.current,onNewRuc:u})}var pe=a(294);function Ee(e){return r.a.createElement(pe.a,{size:"small",column:3},r.a.createElement(pe.a.Item,{label:"Nombre"},e.informer.name),r.a.createElement(pe.a.Item,{label:"ID"},e.informer.identifier))}var ve=a(188),ge=a.n(ve),be=a(336),ye=a.n(be),he=function(){function e(){Object(w.a)(this,e)}return Object(T.a)(e,[{key:"downloadData",value:function(e,t){var a=this.fixDataTypes(e),n=X()().format("YYYYMMDDhhmm"),r="FULL"===t?"".concat(e.identificacion.periodo,"_"):"",o="FULL"===t?"".concat(e.identificacion.tipoPresentacion,"_"):"",i="".concat(e.informante.ruc,"_").concat(r).concat(o).concat(n,".").concat("json");ge()(new Blob([JSON.stringify(a,null,2)]),i,"application/json")}},{key:"downloadAll",value:function(e,t){var a=X()().format("YYYYMMDDhhmm"),n="".concat(e.identifier,"_").concat(a,".").concat("json");ge()(new Blob([JSON.stringify(t,null,2)]),n,"application/json")}},{key:"fixDataTypes",value:function(e){var t=JSON.parse(JSON.stringify(e));return t.ingresos.forEach((function(e){e.ingresoMontoGravado=Number(e.ingresoMontoGravado),e.ingresoMontoNoGravado=Number(e.ingresoMontoNoGravado),e.ingresoMontoTotal=Number(e.ingresoMontoTotal),e.fecha&&(e.periodo=$.mapSETFormatToMoment(e.fecha).year()+""),"5"===e.tipo&&(e.mes="".concat($.mapSETFormatToSetMonth(e.fecha)),delete e.fecha,delete e.timbradoDocumento,delete e.timbradoCondicion,delete e.timbradoNumero)})),t.egresos.forEach((function(e){e.egresoMontoTotal=Number(e.egresoMontoTotal),"gasto"===e.tipo&&(e.tipo="1"),e.periodo=$.mapSETFormatToMoment(e.fecha).year()+"","5"===e.tipo&&"gasto"===e.tipoEgreso&&"DESCJBPN"===e.subtipoEgreso&&(e.mes="".concat($.mapSETFormatToSetMonth(e.fecha)),delete e.timbradoDocumento,delete e.timbradoCondicion,delete e.timbradoNumero)})),t}},{key:"downloadExcel",value:function(e,t,a){if(!Array.isArray(a))throw new Error("Invalid data to download");var n=new Set([]);a.length>0&&Object.keys(a[0]).forEach((function(e){return n.add(e)}));var r=ye.a.unparse({fields:Array.from(n),data:a});console.log(r);var o=X()().format("YYYYMMDDhhmm"),i="".concat(e.identifier,"_").concat(t,"_").concat(o,".csv");ge()(new Blob([r]),i,"text/csv")}},{key:"downloadPeriod",value:function(e,t,a){alert("TODO: Not implemented")}}]),e}();function Oe(){var e=Object(l.useLocalStorage)("informante"),t=Object(c.a)(e,1)[0],a=Object(l.useLocalStorage)("ingresos",[]),n=Object(c.a)(a,1)[0],o=Object(l.useLocalStorage)("egresos",[]),i=Object(c.a)(o,1)[0];return r.a.createElement(g.a,{gutter:[8,8]},r.a.createElement(b.a,{span:24},r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"Puedes exportar tus datos de varias maneras, dependiendo del uso que les daras."))),r.a.createElement("table",{style:{width:"100%"}},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("b",null,"Completo"),r.a.createElement("br",null),r.a.createElement("small",null,"Todos los datos almacenados, \xfatil para guardar y continuar la sesi\xf3n mas tarde")),r.a.createElement("td",{style:{verticalAlign:"bottom"}},r.a.createElement(f.a,{onClick:function(){(new he).downloadAll(t,{informer:t,incomes:n,expenses:i})},style:{width:"100%"}},"Exportar"))),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("b",null,"Ingresos en excel"),r.a.createElement("br",null),r.a.createElement("small",null,"Exportar todos los ingresos, en formato excel para su manipulaci\xf3n")),r.a.createElement("td",{style:{verticalAlign:"bottom"}},r.a.createElement(f.a,{onClick:function(){(new he).downloadExcel(t,"ingresos",n)},style:{width:"100%"}},"Descargar 'ingresos.csv'"))),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("b",null,"Egresos en excel"),r.a.createElement("br",null),r.a.createElement("small",null,"Exportar todos los egresos, en formato excel para su manipulaci\xf3n")),r.a.createElement("td",{style:{verticalAlign:"bottom"}},r.a.createElement(f.a,{onClick:function(){(new he).downloadExcel(t,"egresos",i)},style:{width:"100%"}},"Descargar 'egresos.csv'"))))))}function Ie(e){if(e&&0!==e.length)return e.includes("www.muv-app.co")?function(e){var t=/Timbrado.*:\s+(\d+)/.exec(e),a=/RUC\s*:\s+(\d+)-\d/.exec(e),n=/Total a pagar: Gs. .*- Gs. (.*)\n/.exec(e),r=/Fecha: (.*)\n/.exec(e),o=/Condici\xf3n de Venta: Contado\((.*)\) Cr\xe9dito\((.*)\)\s*\n/.exec(e),i=/Factura N\xb0: (.*)\n/.exec(e);return console.log(r),{type:"invoice",condition:we(o),letterhead:t?parseInt(t[1]):void 0,ruc:a?a[1]:void 0,total:n?parseInt(n[1].replace(/\./,"").replace(/\s/,"")):void 0,date:r?X()(r[1],"DD-MM-YYYY").format("YYYY/MM/DD"):void 0,identifier:i?i[1]:void 0}}(e):void console.log("No template found, returning undefined")}function we(e){if(e)return"X"===e[1].trim()?"cash":"credit"}function Te(e){var t=Object(n.useState)(),a=Object(c.a)(t,2),o=a[0],i=a[1],l=Object(n.useState)(""),u=Object(c.a)(l,2),s=u[0],m=u[1];return r.a.createElement(g.a,{gutter:[20,20]},r.a.createElement(b.a,{span:24},r.a.createElement("textarea",{style:{width:"100%"},value:s,onChange:function(e){return m(e.target.value)}})),r.a.createElement(b.a,{span:24},r.a.createElement(f.a,{onClick:function(){var t=Ie(s);i(t),t&&e.onNewParsed(t)}},"Parsear")),r.a.createElement(b.a,{span:24},r.a.createElement("pre",null,JSON.stringify(o,null,2))))}var Se=a(233),Ce=new(function(){function e(){Object(w.a)(this,e)}return Object(T.a)(e,[{key:"migrate",value:function(e){return{version:2,user:this.migrateUser(e.informante),expenses:e.egresos.map(this.migrateExpense),incomes:e.ingresos.map(this.migrateIncome)}}},{key:"needsMigration",value:function(e){return!e||!e.version||2!==e.version}},{key:"anyNeedsMigration",value:function(e){var t=this;return!e||!!e.find((function(e){return t.needsMigration(e)}))}},{key:"migrateUser",value:function(e){return null===e||void 0===e||"string"===typeof e?{version:2,identifier:"0-0",name:"EMPY",type:"FISICO"}:"version"in e?e:{version:2,identifier:e.ruc,name:e.nombre,type:"FISICO",older:{v1:e}}}},{key:"migrateIncome",value:function(e){return"version"in e?e:{version:2,id:e.id,amount:e.ingresoMontoTotal,date:$.mapDateFromSetFormat(e.fecha),identifier:e.relacionadoNumeroIdentificacion,identifierType:"ruc",irpAmount:0,name:e.relacionadoNombres,type:"salary",voucher:e.timbradoDocumento,paymentType:"credito"===e.tipoIngreso?"credit":"cash",letterhead:e.timbradoNumero,older:{v1:e}}}},{key:"migrateExpense",value:function(e){return"version"in e?e:{version:2,id:e.id,amount:e.egresoMontoTotal,date:$.mapDateFromSetFormat(e.fecha),identifier:e.relacionadoNumeroIdentificacion,identifierType:"ruc",letterhead:e.timbradoNumero,name:e.relacionadoNombres,voucher:e.timbradoDocumento,irpAmount:0,type:"invoice",paymentType:"contado"===e.timbradoCondicion?"cash":"credit",older:{v1:e}}}}]),e}());function De(e){var t=Object(n.useState)(0),a=Object(c.a)(t,2),o=a[0],i=a[1],l=Object(n.useMemo)((function(){var t=Object(Z.countBy)(e.expenses,"voucher");return Object.keys(t).filter((function(e){return t[e]>1}))}),[e.expenses]),u=o>l.length?0:o,s=l[u],m=e.expenses.filter((function(e){return e.voucher===s})),d=Object.keys(l).length;return m&&0!==m.length?r.a.createElement(g.a,{gutter:[20,20]},r.a.createElement(b.a,{span:24},"Duplicado actual ",s," (",o+1,"), cantidad total ",d),r.a.createElement(b.a,{span:24},r.a.createElement(f.a,{disabled:u<1,onClick:function(){return i((function(e){return u-1}))}},"Anterior"),r.a.createElement(f.a,{disabled:u+1===d,onClick:function(){return i((function(e){return u+1}))}},"Siguiente")),r.a.createElement(b.a,null,r.a.createElement(g.a,null,m.map((function(t){return r.a.createElement(b.a,{key:t.id},r.a.createElement("pre",null,JSON.stringify(t,null,2)),r.a.createElement(f.a,{type:"danger",onClick:function(){return e.onRemove(t.id)}},"Eliminar este registro"))}))))):r.a.createElement(r.a.Fragment,null,"No se encontraron duplicados. (",o,")")}function je(){var e,t,a=function(){var e=Object(l.useLocalStorage)("informante"),t=Object(c.a)(e,3),a=t[0],r=t[1],o=t[2],i=Object(l.useLocalStorage)("ingresos",[]),u=Object(c.a)(i,3),s=u[0],m=u[1],d=u[2],f=Object(l.useLocalStorage)("egresos",[]),p=Object(c.a)(f,3),E=p[0],v=p[1],g=p[2],b=Object(n.useState)(!0),y=Object(c.a)(b,2),h=y[0],O=y[1],I=Object(n.useMemo)((function(){return{doc:(null===a||void 0===a?void 0:a.identifier)||"",old:"",div:"",name:(null===a||void 0===a?void 0:a.name)||""}}),[a]),w=(new Date).getFullYear(),T=Object(n.useMemo)((function(){return new $(w,I,(null===a||void 0===a?void 0:a.type)||"FISICO",E||[],s||[])}),[w,I,a,E,s]);return Object(n.useEffect)((function(){(a||s&&0!==s.length||E&&0!==E.length)&&(!a||Ce.needsMigration(a)||!s||Ce.anyNeedsMigration(s)||!E||Ce.anyNeedsMigration(E))?(console.log(a,s,E),console.log(Ce.needsMigration(a),Ce.anyNeedsMigration(s||[]),Ce.anyNeedsMigration(E||[])),O(!0),setTimeout((function(){var e=a,t=s,n=E;r(Ce.migrateUser(e)),t&&Ce.anyNeedsMigration(t)&&m(t.map(Ce.migrateIncome)),n&&Ce.anyNeedsMigration(n)&&v(n.map(Ce.migrateExpense)),O(!1)}))):O(!1)}),[h,a,s,E,m,r,v]),{isMigrating:h,expenses:E||[],saveExpense:function(e,t){return t?(v((E||[]).map((function(a){return a.id===t?T.mapInvoice(e,t):a}))),{wasNew:!1}):(v([].concat(Object(Se.a)(E||[]),[T.mapInvoice(e)])),{wasNew:!0})},removeExpense:function(e){v((E||[]).filter((function(t){return t.id!==e})))},saveIncome:function(e,t){return t?(m((s||[]).map((function(a){return a.id===t?T.mapIncome(e,t):a}))),{wasNew:!1}):(m([].concat(Object(Se.a)(s||[]),[T.mapIncome(e,t)])),{wasNew:!0})},removeIncome:function(e){m((s||[]).filter((function(t){return t.id!==e})))},incomes:s||[],informer:a,clearAllData:function(){g(),d(),o()},owner:I,period:w,searchRuc:function(e){return K.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",T.findRuc(e));case 1:case"end":return t.stop()}}))}}}(),o=Object(n.useState)(!1),i=Object(c.a)(o,2),v=i[0],g=i[1],b=Object(n.useState)(!1),y=Object(c.a)(b,2),h=y[0],O=y[1];return a.isMigrating?r.a.createElement(m.a,{title:"Cargando"},"Migrando datos a versi\xf3n actual, por favor espere..."):r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{ghost:!1,style:{border:"1px solid rgb(235, 237, 240)"},title:"MISCO",subTitle:"Sistema suplementario para Aranduka",extra:[r.a.createElement(f.a,{key:"import",onClick:function(){return g(!0)}},"Importar"),r.a.createElement(f.a,{key:"export",onClick:function(){return O(!0)}},"Exportar"),r.a.createElement(f.a,{key:"clear",type:"danger",onClick:function(){u.a.warning({title:"Cerrar sesi\xf3n",content:"Esta seguro de que desea cerrar sesi\xf3n? Todos los datos no guardados se perderan",cancelText:"Volver",okCancel:!0,okText:"S\xed, cerrar y borrar datos",okType:"danger",onOk:function(){a.clearAllData(),s.a.warning("Todos los datos han sido borrados",10)}})}},"Cerrar sesi\xf3n")],footer:r.a.createElement(p.a,{defaultActiveKey:"1"},r.a.createElement(p.a.TabPane,{tab:"Egresos",key:"1"},r.a.createElement(oe,{data:a.expenses,onSave:a.saveExpense,doRemove:a.removeExpense,type:(null===(e=a.informer)||void 0===e?void 0:e.type)||"FISICO",owner:a.owner,period:a.period})),r.a.createElement(p.a.TabPane,{tab:"Ingresos",key:"2"},r.a.createElement(me,{data:a.incomes,onSave:a.saveIncome,doRemove:a.removeIncome,type:(null===(t=a.informer)||void 0===t?void 0:t.type)||"FISICO",owner:a.owner,period:a.period})),r.a.createElement(p.a.TabPane,{tab:"Egresos duplicados",key:"3"},r.a.createElement(De,{expenses:a.expenses,onRemove:a.removeExpense})))}," ",a.informer&&r.a.createElement(Ee,{informer:a.informer})," "),r.a.createElement(E.a,{title:"Exportar datos",width:720,onClose:function(){return O(!1)},visible:h,bodyStyle:{paddingBottom:80},footer:r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(f.a,{onClick:function(){return O(!1)},style:{marginRight:8}}," Volver "))},r.a.createElement(Oe,null)),r.a.createElement(Ne,{visible:v,onOk:function(e){e.ruc&&a.searchRuc(e.ruc).then((function(t){var n,r;a.saveExpense((r=t,{date:(n=e).date,type:n.type,amount:n.total,letterhead:n.letterhead+"",expenseNumber:n.identifier,isCredit:"cash"!==n.condition,owner:r})),s.a.info("Factura ".concat(e.identifier," de ").concat(t.name," importada")),g(!1)})).catch((function(t){s.a.warning("No se encuentra el ruc ".concat(e.ruc))}))},onCancel:function(){return g(!1)}}))}function Ne(e){var t=Object(n.useState)(),a=Object(c.a)(t,2),o=a[0],i=a[1];return r.a.createElement(u.a,{visible:e.visible,okText:"Importar",onCancel:function(){return e.onCancel()},okButtonProps:{disabled:!o},onOk:function(){return o&&e.onOk(o)}},r.a.createElement(Te,{onNewParsed:function(e){return i(e)}}))}var ke=a(297),xe=a(288),Ae=a(646),Me=function(){function e(){Object(w.a)(this,e)}return Object(T.a)(e,[{key:"doImport",value:function(e){var t=e;if("informer"in t)return Object(l.writeStorage)("informante",t.informer),Object(l.writeStorage)("ingresos",t.incomes),void Object(l.writeStorage)("egresos",t.expenses);Object(l.writeStorage)("informante",e.informante),Object(l.writeStorage)("ingresos",this.fixIncomes(e.ingresos)),Object(l.writeStorage)("egresos",e.egresos),Object(l.writeStorage)("identificacion",e.identificacion),Object(l.writeStorage)("familiares",e.familiares)}},{key:"fixIncomes",value:function(e){return e&&0!==e.length?e.map((function(e){if("version"in e)return e;var t=e.fecha;if(!t){if(!e.mes)throw new Error("Ingreso inv\xe1lido, verificar ".concat(e.id," con fecha ").concat(e.fecha," mes ").concat(e.mes));t=$.mapMomentToSETFormat(X()("1990-01-01").month(parseInt(e.mes)-1).year(parseInt(e.periodo)))}return Object(x.a)({},e,{fecha:t})})):[]}}]),e}();function Fe(e){return K.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:Object(l.writeStorage)("informante",e),Object(l.writeStorage)("ingresos",[]),Object(l.writeStorage)("egresos",[]);case 3:case"end":return t.stop()}}))}function Re(){var e=Object(n.useState)(!1),t=Object(c.a)(e,2),a=t[0],o=t[1];return r.a.createElement(d.a,{ghost:!1,style:{border:"1px solid rgb(235, 237, 240)"},title:"MISCO",subTitle:"Sistema suplementario para Aranduka",extra:[]},r.a.createElement(g.a,{gutter:[16,16],style:{margin:16}},r.a.createElement(b.a,{span:24},r.a.createElement(N.a,{message:" Para usar el sistema debes importar datos del Aranduka ",type:"warning"})),r.a.createElement(b.a,{span:24},r.a.createElement(ke.a,null,r.a.createElement(ke.a.Item,null,"Descarga e instala Aranduka"),r.a.createElement(ke.a.Item,null,"Inicia sesi\xf3n y completa tus tados"),r.a.createElement(ke.a.Item,null,"Puedes cargar unas egresos e ingresos"),r.a.createElement(ke.a.Item,null,"Exporta tus datos"),r.a.createElement(ke.a.Item,null,"Descomprime el archivo, y luego sub\xed el archivo que termina en ",r.a.createElement("b",null,"detalle.json"),".",r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(xe.a,{beforeUpload:function(e){return function(e){new Promise((function(t){var a=new FileReader;a.readAsText(e,"UTF-8"),a.onload=function(){var e=JSON.parse(a.result);(new Me).doImport(e),t()}}))}(e),!1}},r.a.createElement(f.a,null,r.a.createElement(Ae.a,null)," Click para subir archivo")),r.a.createElement("br",null),r.a.createElement("small",null,"Tambi\xe9n puedes utilizar el archivo que genera este sistema.")))),r.a.createElement(b.a,{span:24},r.a.createElement(f.a,{onClick:function(){return o(!0)},type:"primary"},"Tambi\xe9n puedes empezar desde 0 apretando este bot\xf3n"))),r.a.createElement(Le,{visible:a,onCancel:function(){return o(!1)},onAccept:Fe}))}function Ye(e){return e.indexOf("-")>=0?e:"".concat(e,"-").concat((new H).getDigitoVerificadorBase11(e))}function Le(e){var t=A.a.useForm(),a=Object(c.a)(t,1)[0],o=Object(n.useState)(!1),i=Object(c.a)(o,2),l=i[0],m=i[1];return r.a.createElement(u.a,{visible:e.visible,title:"Empezar desde 0",okText:"Aceptar",cancelText:"Cancelar",onCancel:e.onCancel,onOk:function(){s.a.loading({key:"scratch",message:"Guardando"}),m(!0),a.validateFields().then((function(t){return e.onAccept({identifier:Ye(t.identifier),name:"".concat(t.name).toUpperCase(),type:t.type,version:2})})).then((function(){a.resetFields(),s.a.success({key:"scratch",message:"Bienvenido"})})).catch((function(e){console.warn(e),s.a.warning({key:"scratch",message:"Error al validar campos"})})).finally((function(){return m(!1)}))}},r.a.createElement(A.a,Object.assign({form:a},{labelCol:{span:8},wrapperCol:{span:16}},{layout:"horizontal",name:"form_in_modal",initialValues:{type:"FISICO"}}),r.a.createElement(A.a.Item,{name:"identifier",label:"Documento",rules:[{required:!0,message:"Ingrese su documento"}]},r.a.createElement(y.a,{disabled:l})),r.a.createElement(A.a.Item,{name:"name",label:"Nombre",rules:[{required:!0,message:"Ingrese su nombre"}]},r.a.createElement(y.a,{disabled:l})),r.a.createElement(A.a.Item,{name:"type",label:"Tipo"},r.a.createElement(F.a.Group,{disabled:l,defaultValue:"FISICO"},r.a.createElement(F.a,{value:"FISICO"},"F\xedsico"),r.a.createElement(F.a,{value:"SOCIEDAD_SIMPLE"},"Sociedad simple")))))}function Be(){var e=Object(l.useLocalStorage)("informante");return Object(c.a)(e,1)[0]?r.a.createElement(je,null):r.a.createElement(Re,null)}Object(Y.configure)({logLevel:"warn"});var Pe=function(){return r.a.createElement(Be,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Pe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[338,1,2]]]);
//# sourceMappingURL=main.cd0e5084.chunk.js.map